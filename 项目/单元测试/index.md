# 大纲

## 理念性的问题

1. 自动化测试的重要性
2. 单元测试的重要性
3. 单元测试的着手点


## 技术性的问题
1. [jest 的使用总结](https://jestjs.io/docs/zh-Hans/api)
2. [vue-test-unit 的实战使用](https://vue-test-utils.vuejs.org/zh/)
3. 现有前端项目添加单元测试的一些问题
--

### 单元测试

在前端领域，单元测试重要吗？这个不太能准确给出一个统一的答案。还是要结合你当前的项目情况。社区中一个功能完整的工具库会提供详情的单测用例；项目中很多基础的公用组件，也会配备单测用例；

在一些重前端的项目中，前端交互繁杂，所要处理的逻辑相对于后端也不妨多让，那么这部分业务逻辑最好也加上单测，因为如果不写单元测试，每次发布之前都要投入人力来进行手工测试；而且对于老旧代码的结构不敢随意触碰，这会导致代码逐渐腐化，复杂度越来越高。

对于业务不稳定，而且偏向展示的轻逻辑页面，那么单测就有些得不偿失了。

如果在最初就定下了要写单元测试，那么这也会倒逼开发人员写出更通顺的流程，更解耦的模块，更单一的方法，这是一种增加开发人员资深开发的底蕴。

如果是在项目中后期想要添加单测，这也可以帮助理清代码功能，写下一个完整的单测文件能够覆盖到被测试文件的主要功能点，对已有代码逻辑查漏补缺，更加重要的是，如果哪一天实在忍受不了这一块代码想要重构，那么这个增加的单元测试文件就是你重构代码的底气。 

> 再考虑到以下两大事实：人员会流动，应用会变大。人员一定会流动，需求一定会增加，直至再也没有一个人能够了解应用的所有功能，那时对应用做出修改的成本将变得很高。因此，意图依赖人、依赖手工的方式来应对响应力的挑战首先是低效的，从时间维度上来讲也是不可能的。因此，为了服务于“高响应力”这个目标，随时重构整理代码是必须的，这就需要我们有一套自动化的测试套件，它能帮我们提供快速反馈，做质量的守卫者。唯解决了人工、质量的这一环，开发效率才能稳步提升，团队和企业的高响应力才可能达到。

### 单元测试的着手点

**前端单元测试的重点是逻辑的完整，不是数据和UI**。数据可以mock，UI只需要考虑对应元素是否存在，至于样式还是要在浏览器中点点看，如何判断逻辑是否完整，就是通过确定一个**合适的输入和输出**

在写单测方面，前端代码可以粗糙的分成这么几部分：
1. 页面展示的UI组件
2. 项目公用组件，一般为页面组件提供支持
3. 类似于vuex的状态管理文件，负责为页面组件提供数据
4. 工具性代码组成的JS（ts）文件，可能是完整的逻辑封装，可能只是工具性代码的集合

无论是对哪一种文件写单测，我们首先要明确的就是**这个单测模块的输入和输出是什么**？

对于后三种情况，我们一般都能很快总结出来他的输入和输出是什么，但对于UI组件可能有点不同。
 
对于 UI 组件来说，我们不推荐一味追求行级覆盖率，因为它会导致我们过分关注组件的内部实现细节，从而导致琐碎的测试。琐碎的测试没有错，但会耗费大量的精神，投入和收获不成正比。

如果有必要添加测试的话，我是将其当作一个功能黑盒来测试的，输入的话就完全站在用户视角，包括鼠标，键盘等用户操作，而要测试的输出可能是页面元素的变化，接口的调用，路由的跳转或状态的更新等。 UI组件的输入输出形式比较繁杂，我们要做好分析和取舍。至于内部的`data`,`computed`,`methods`,`watch`等不在一一考虑，只要这些组合起来能够得到我预期的测试结果就好。 
  

### jest的实战总结


### vue-test-unit 的实战使用




选项中的 `scopedSlots` 只能处理**本组件**中的作用域插槽

shallowMount 只能渲染默认插槽和具名插槽中的内容，带有作用域的插槽不能被默认渲染


测试组件过程中，某些配置需要根据全局方法的逻辑来判断该如何做




**Vue测试过程中全局和局部的关系**
局部依赖全局的数据，方法该怎么做

https://github.com/vuejs/vue-test-utils/pull/1309

https://juejin.im/post/6844904057094537229


https://vuex.vuejs.org/zh/guide/testing.html


